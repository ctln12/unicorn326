<div class="row mt-1">
  <div class="col-3">
    <% @chats.each do |chat| %>
      <%= link_to chat_path(chat), class: "chat-tutor", style: "text-decoration: none; color: black;" do %>
        <div style="height: 60px; margin-bottom: 10px; padding-left: 10px; background-color: white; border-radius: 5px;<%= @chat.tutor == chat.tutor ? "font-weight: bold; border-left: 5px solid #167FFB" : "border-left: 5px solid transparent" %>">
          <%= image_tag "https://kitt.lewagon.com/placeholder/users/ssaunier", class: "avatar", style: "margin: 5px; margin-top: 10px;" %>
          <span><%= student_signed_in? ? chat.tutor.first_name : chat.student.first_name %></p>
        </div>
      <% end %>
    <% end %>
  </div>

  <div class="col-9">
    <div style="display: flex; align-items: center;">
      <%= image_tag "https://kitt.lewagon.com/placeholder/users/ssaunier", class: "avatar", style: "width: 56px; height: 56px;" %>
      <div style="padding-left: 15px;">
        <h5 style="margin: 15px 0 0 0;"><strong><%= @chat.tutor.first_name %></strong></h5>
        <p style="font-size: 0.9rem; font-weight: lighter; color: #696969;">Online</p>
      </div>
    </div>
    <div class="chat" data-channel-subscribe="chat" data-chat-id="<%= @chat.id %>" style="height: calc(100vh - 200px); border-radius: 3px 3px 0 0; overflow-y: auto;">
      <% @messages.each do |message| %>

        <div class="chat-message-container" style="padding: 5px;">

          <div class="row no-gutters">

              <% if student_signed_in? && @chat.student.first_name == message.username || tutor_signed_in? && @chat.tutor.first_name == message.username %>

                <div class="col" style="display: flex; justify-content: flex-end; }">
                  <div id="<%= message.username %>" class="message-content" style= "margin-top: 10px; padding: 10px 15px; border-radius: 10px 10px 0 10px; background: white; width: 70%;">
                    <p class="mb-1">
                      <%= message.content %>
                    </p>
                    <div class="text-right">
                      <small style="color: #4c4c4c">
                        <%= message.created_at %>
                      </small>
                    </div>
                  </div>
                </div>

                <div class="col-auto text-center">
                  <%= image_tag "https://kitt.lewagon.com/placeholder/users/ssaunier", class: "avatar", style: "margin: 5px; margin-top: 10px;" %>
                </div>

              <% else %>

                <div class="col-auto text-center">
                  <%= image_tag "https://kitt.lewagon.com/placeholder/users/ssaunier", class: "avatar", style: "margin: 5px; margin-top: 10px;" %>
                </div>

                <div class="col">
                  <div id="<%= message.username %>" class="message-content" style= "margin-top: 10px; padding: 10px 15px; border-radius: 10px 10px 10px 0; background: #bbdff9; width: 70%;">
                    <p class="mb-1" style="color: black;">
                      <%= message.content %>
                    </p>
                    <div class="text-right">
                      <small style="color: #4c4c4c">
                        <%= message.created_at %>
                      </small>
                    </div>
                  </div>
                </div>
              <% end %>

            </div>

        </div>

      <% end %>
    </div>

    <%= simple_form_for @message, remote: true do |f| %>
      <div style="border-top: 1px solid #cecece; display: flex;">
        <%= f.input :content, as: :string,
                                 wrapper: false,
                                 label: false, placeholder: "Write your message...",
                                 input_html: {
                                   class: 'chat-input mt-2',
                                   style: "border: none; background-color: transparent;"
                                 } %>
        <%= f.input :username, as: :hidden %>
        <%= f.input :chat_id, as: :hidden  %>
        <%= f.submit "Send", class: 'btn btn-primary chat-input mt-2' %>
      </div>

    <% end %>
  </div>
</div>

<div class="d-none" data-role="message-template">
  <div class="chat-message-container" style="padding: 5px; margin-top: 10px;">
    <div class="row no-gutters">
      <div class="col-auto text-center">
        <img src="" class="avatar" style= "margin: 5px; margin-top: 10px;" alt="" data-role="user-avatar">
      </div>

      <div class="col">
        <div class="message-content" style= "margin-top: 10px; padding: 5px; border: 1px solid #83c0d4; border-radius: 5px; background: #add8e6; color: #103744;">
          <p class="mb-1" data-role="message-text"></p>

          <div class="text-right" style="color: #014c65">
            <small data-role="message-date"></small>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>
